{"ast":null,"code":"var _jsxFileName = \"/Users/akhand/Developer/power-search/quickstart-react/src/views/SearchView.js\";\nimport React, { useState, useEffect } from 'react';\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { Button, PageHeader, Input, AutoComplete, Menu, Row, Col, Empty, Select, Collapse, Table, Radio } from 'antd';\nimport { PlayCircleFilled, DownOutlined, LoadingOutlined, SearchOutlined, BorderlessTableOutlined, BookOutlined } from '@ant-design/icons';\nimport '@tensorflow/tfjs-backend-webgl';\nimport mondaySdk from \"monday-sdk-js\";\nconst monday = mondaySdk();\nconst {\n  Search\n} = Input;\nconst {\n  Option\n} = Select;\nconst {\n  Panel\n} = Collapse; // const { Option } = AutoComplete;\n\nconst qna = require(\"@tensorflow-models/qna\");\n\nconst SearchView = () => {\n  const [dataLoading, setDataLoading] = useState(false);\n  const [resultsLoading, setResultsLoading] = useState(false);\n  const [boardGroups, setBoardGroups] = useState([]);\n  const [boardColumns, setBoardColumns] = useState([]);\n  const [allData, setAllData] = useState({});\n  const [allResults, setAllResults] = useState({});\n  const [wiki, setWiki] = useState(\"\");\n  const [isMounted, setIsMounted] = useState(false);\n  const [boardId, setBoardId] = useState(\"\");\n  const [model, setModel] = useState();\n  const [question, setQuestion] = useState(\"\");\n  const [dataSource, setDataSource] = useState([]);\n  const [resultsColumns, setResultsColumns] = useState([]);\n  const [tableDataSource, setTableDataSource] = useState([]);\n  const [tableDataColumns, setTableDataColumns] = useState([]);\n  const [searchGroups, setSearchGroups] = useState([\"All Groups\"]);\n  const [searchColumns, setSearchColumns] = useState([\"All Columns\"]);\n  const [searchType, setSearchType] = useState(\"question\");\n  const [responseView, setResponseView] = useState(false);\n  const [itemIdToCorpusIdx, setItemIdToCorpusIdx] = useState({});\n  const [itemAllResults, setItemAllResults] = useState({});\n  const [getQAutoComplete, setGetQAutoComplete] = useState([]);\n  const backButton = useHistory();\n  const optionsWithDisabled = [{\n    label: /*#__PURE__*/React.createElement(BookOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 45,\n        columnNumber: 18\n      }\n    }),\n    value: false\n  }, {\n    label: /*#__PURE__*/React.createElement(BorderlessTableOutlined, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 46,\n        columnNumber: 18\n      }\n    }),\n    value: true\n  } // { label: 'Orange', value: 'Orange', disabled: true },\n  ];\n\n  const handleSearch = value => {\n    let res = [];\n\n    if (!value || value.indexOf('@') >= 0) {\n      res = [];\n    } else {\n      res = ['gmail.com', '163.com', 'qq.com'].map(domain => `${value}@${domain}`);\n    }\n\n    setGetQAutoComplete(res);\n  };\n\n  const groupMenu = /*#__PURE__*/React.createElement(Select, {\n    mode: \"multiple\",\n    style: {\n      width: '100%'\n    },\n    placeholder: \"select one country\",\n    defaultValue: searchGroups,\n    onChange: getSearchGroups,\n    optionLabelProp: \"label\",\n    value: searchGroups,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 9\n    }\n  }, boardGroups.map(function (group, index) {\n    return /*#__PURE__*/React.createElement(Option, {\n      value: group.id,\n      label: group.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"demo-option-label-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 21\n      }\n    }, group.title));\n  }));\n  const columnMenu = /*#__PURE__*/React.createElement(Select, {\n    mode: \"multiple\",\n    style: {\n      width: '100%'\n    },\n    placeholder: \"select one country\",\n    defaultValue: searchColumns,\n    onChange: getSearchColumns,\n    optionLabelProp: \"label\",\n    value: searchColumns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 9\n    }\n  }, boardColumns.map(function (column, index) {\n    return /*#__PURE__*/React.createElement(Option, {\n      value: column.id,\n      label: column.title,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 17\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"demo-option-label-item\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 21\n      }\n    }, column.title));\n  }));\n  const typeOfSearchMenu = /*#__PURE__*/React.createElement(Select, {\n    defaultValue: \"question\",\n    style: {\n      width: '100%'\n    },\n    onSelect: value => {\n      console.log(value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(Option, {\n    value: \"question\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 13\n    }\n  }, \"Ask Anything\"), /*#__PURE__*/React.createElement(Option, {\n    value: \"keywords\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 13\n    }\n  }, \"Match Keywords\"), /*#__PURE__*/React.createElement(Option, {\n    value: \"regex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 13\n    }\n  }, \"Regex Search\"));\n\n  function getSearchColumns(value) {\n    if (value.length > 1) {\n      if (value[0] === \"All Columns\") {\n        value.splice(0, 1);\n      }\n    }\n\n    if (value.length === 0) {\n      value.push(\"All Columns\");\n    }\n\n    setSearchColumns(value);\n    console.log(value);\n  }\n\n  function getSearchGroups(value) {\n    if (value.length > 1) {\n      if (value[0] === \"All Groups\") {\n        value.splice(0, 1);\n      }\n    }\n\n    if (value.length === 0) {\n      value.push(\"All Groups\");\n    }\n\n    setSearchGroups(value);\n    console.log(value);\n  }\n\n  function clickBackButton() {\n    backButton.push('/');\n  }\n\n  function getQuestionFromInput(value) {\n    setQuestion(value);\n  }\n\n  async function runSearch() {\n    // create Wiki based on groups and columns selected\n    if (searchType === \"question\") {\n      setResultsLoading(true);\n\n      if (model) {\n        let answers = await model.findAnswers(question, wiki);\n        setAllResults(answers);\n      }\n    } else if (searchType === \"regex\") {\n      setAllResults({\n        text: \"SIR PLS\"\n      });\n    } else {\n      setAllResults({\n        text: \"SUR PLS\"\n      });\n    }\n  }\n\n  useEffect(() => {\n    if (isMounted) {\n      // when results change, update datasource and columns\n      let newDatasource = [];\n      let newResultsColumns = [];\n      let itemIdsToFetch = new Set();\n\n      if (searchType === \"question\") {\n        for (let i = 0; i < allResults.length; i++) {\n          newDatasource.push({\n            'Results': allResults[i].text\n          }); // newDatasource[i]['key'] = i;\n        }\n\n        if (allResults[0]) {\n          // let cols = Object.keys(allResults[0])\n          newResultsColumns.push({\n            title: \"Results\",\n            dataIndex: \"Results\",\n            key: \"Results\"\n          }); // for(let j = 0; j <= cols.length; j++){\n          //     newResultsColumns.push({\n          //         title: cols[j],\n          //         dataIndex: cols[j],\n          //         key: cols[j],\n          //     })\n          // }\n        }\n      } else if (searchType === \"regex\") {}\n\n      setDataSource(newDatasource);\n      setResultsColumns(newResultsColumns);\n      setResultsLoading(false);\n    }\n  }, [allResults]);\n\n  async function getResultItems() {}\n\n  useEffect(() => {\n    if (isMounted) {\n      console.log(dataSource);\n    }\n  }, [dataSource]);\n  useEffect(() => {\n    if (isMounted) {\n      console.log(resultsColumns);\n    }\n  }, [resultsColumns]);\n  useEffect(() => {\n    // getBoardId()\n    monday.listen(\"context\", getContext);\n    setDataLoading(true);\n    loadModel();\n    setIsMounted(true);\n    setDataLoading(false);\n  }, []);\n  useEffect(() => {\n    if (isMounted) {\n      setDataLoading(true);\n      getBoardGroups();\n      getAllData();\n      setDataLoading(false); // gets triggered whenever boardId changes\n      // getBoardColumns() //\n      // get other stuff dependent on boardId too!\n    }\n  }, [boardId]);\n  useEffect(() => {\n    if (isMounted) {\n      setDataLoading(true);\n      createWiki();\n      setDataLoading(false);\n    }\n  }, [allData]);\n  useEffect(() => {\n    if (isMounted) {// add something here?\n    }\n  }, [itemIdToCorpusIdx]);\n  useEffect(() => {\n    if (isMounted) {// do something here?\n    }\n  }, [responseView]);\n  useEffect(() => {\n    if (isMounted) {\n      setDataLoading(true);\n      createWiki();\n      setDataLoading(false);\n    }\n  }, [searchColumns, searchGroups]);\n\n  async function loadModel() {\n    const runModel = await qna.load(); // importing the model\n\n    setModel(runModel);\n  }\n\n  function createWiki() {\n    let corpus = \"\";\n    let items = allData.boards[0].items; // let searchColumnIds = searchColumns.map( item => { return item.id })\n\n    let setSearchColumnIds = new Set(searchColumns);\n    let itemIdMap = {}; // console.log(searchColumns)\n    // console.log(setSearchColumnIds)\n    // let column_ids = set(searchColumns)\n\n    for (let i = 0; i < items.length; i++) {\n      let item = items[i];\n      let item_name = items[i].name;\n      let item_id = items[i].id;\n      itemIdMap[item_id] = corpus.length; // console.log(itemIdMap)\n\n      corpus += \"This is the entry for item \" + item_name + '.';\n\n      for (let j = 0; j < item.column_values.length; j++) {\n        let column = item.column_values[j];\n        let column_type = column.type;\n        let column_text = column.text;\n        let column_id = column.id;\n        console.log(column_id);\n\n        if (setSearchColumnIds.has(column_id) || searchColumns[0] === \"All Columns\") {\n          // This is going to change in a bit\n          if (column_type === \"text\") {\n            corpus += column_text;\n          }\n        }\n      }\n    }\n\n    setWiki(corpus);\n    setItemIdToCorpusIdx(itemIdMap);\n  }\n\n  useEffect(() => {\n    console.log(wiki);\n  }, [wiki]);\n\n  async function getContext(res) {\n    setBoardId(res.data.boardIds[0]);\n  }\n\n  async function getAllData() {\n    monday.api(`query {boards(ids:[${boardId}]) {items(limit:10000) {id, name, column_values {id, text, type, value, title}}}}`).then(res => {\n      setAllData(res.data);\n      console.log(res.data);\n    });\n  }\n\n  async function getBoardGroups() {\n    monday.api(`query { boards(ids: ${boardId}) { columns { id title } groups { id title }} } `).then(res => {\n      setBoardGroups(res.data.boards[0].groups);\n      setBoardColumns(res.data.boards[0].columns);\n    });\n  }\n\n  function selectResponseView(e) {\n    if (e.target.value === false) {\n      setResponseView(false);\n    } else {\n      setResponseView(true);\n    }\n  }\n\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(PageHeader, {\n    className: \"site-page-header\",\n    onBack: clickBackButton,\n    title: \"Super Search\",\n    subTitle: \"Get answers from your boards!\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 341,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"site-statistic-demo-card\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 347,\n      columnNumber: 13\n    }\n  }, dataLoading ? /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    justify: \"center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 349,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(LoadingOutlined, {\n    style: {\n      fontSize: 48\n    },\n    spin: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 350,\n      columnNumber: 25\n    }\n  })) : /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    flex: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(AutoComplete, {\n    style: {\n      width: \"100%\"\n    },\n    onSearch: handleSearch,\n    placeholder: \"input here\",\n    shape: \"round\",\n    size: \"large\",\n    suffix: /*#__PURE__*/React.createElement(SearchOutlined, {\n      className: \"site-form-item-icon\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 373,\n        columnNumber: 33\n      }\n    }),\n    value: question,\n    onChange: getQuestionFromInput,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 364,\n      columnNumber: 26\n    }\n  }, getQAutoComplete.map(email => /*#__PURE__*/React.createElement(Option, {\n    key: email,\n    value: email,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 33\n    }\n  }, email)))), /*#__PURE__*/React.createElement(Col, {\n    span: 4,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 385,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    type: \"primary\",\n    size: \"large\",\n    shape: \"round\",\n    block: true,\n    onClick: runSearch,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 29\n    }\n  }, \"Search\"))), boardId ? /*#__PURE__*/React.createElement(\"div\", {\n    className: \"container\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 391,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 392,\n      columnNumber: 22\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    flex: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Collapse, {\n    defaultActiveKey: ['0'],\n    ghost: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 394,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Panel, {\n    header: \"Advanced Options\",\n    key: \"1\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 395,\n      columnNumber: 33\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    gutter: 16,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 396,\n      columnNumber: 37\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    span: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 397,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 398,\n      columnNumber: 45\n    }\n  }, \"Select groups\"), groupMenu), /*#__PURE__*/React.createElement(Col, {\n    span: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 401,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 45\n    }\n  }, \"Select columns\"), columnMenu), /*#__PURE__*/React.createElement(Col, {\n    span: 8,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 41\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 406,\n      columnNumber: 45\n    }\n  }, \"Select type of search\"), typeOfSearchMenu)))))), /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 414,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    flex: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 415,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(Radio.Group, {\n    options: optionsWithDisabled,\n    onChange: selectResponseView,\n    value: responseView,\n    optionType: \"button\",\n    buttonStyle: \"solid\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 416,\n      columnNumber: 33\n    }\n  }))), /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 425,\n      columnNumber: 25\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    flex: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 426,\n      columnNumber: 29\n    }\n  }, resultsLoading ? /*#__PURE__*/React.createElement(Table, {\n    loading: true,\n    dataSource: dataSource,\n    columns: resultsColumns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 429,\n      columnNumber: 41\n    }\n  }) : responseView ? /*#__PURE__*/React.createElement(Table, {\n    dataSource: dataSource,\n    columns: resultsColumns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 432,\n      columnNumber: 45\n    }\n  }) : /*#__PURE__*/React.createElement(Table, {\n    dataSource: tableDataSource,\n    columns: tableDataColumns,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 434,\n      columnNumber: 45\n    }\n  })))) : /*#__PURE__*/React.createElement(Row, {\n    gutter: [16, 24],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 441,\n      columnNumber: 26\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    flex: \"auto\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 443,\n      columnNumber: 26\n    }\n  }, /*#__PURE__*/React.createElement(Empty, {\n    description: /*#__PURE__*/React.createElement(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 446,\n        columnNumber: 28\n      }\n    }, \"Please select a board to continue...\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 444,\n      columnNumber: 26\n    }\n  })))));\n};\n\nexport default SearchView;","map":{"version":3,"sources":["/Users/akhand/Developer/power-search/quickstart-react/src/views/SearchView.js"],"names":["React","useState","useEffect","useHistory","useParams","Button","PageHeader","Input","AutoComplete","Menu","Row","Col","Empty","Select","Collapse","Table","Radio","PlayCircleFilled","DownOutlined","LoadingOutlined","SearchOutlined","BorderlessTableOutlined","BookOutlined","mondaySdk","monday","Search","Option","Panel","qna","require","SearchView","dataLoading","setDataLoading","resultsLoading","setResultsLoading","boardGroups","setBoardGroups","boardColumns","setBoardColumns","allData","setAllData","allResults","setAllResults","wiki","setWiki","isMounted","setIsMounted","boardId","setBoardId","model","setModel","question","setQuestion","dataSource","setDataSource","resultsColumns","setResultsColumns","tableDataSource","setTableDataSource","tableDataColumns","setTableDataColumns","searchGroups","setSearchGroups","searchColumns","setSearchColumns","searchType","setSearchType","responseView","setResponseView","itemIdToCorpusIdx","setItemIdToCorpusIdx","itemAllResults","setItemAllResults","getQAutoComplete","setGetQAutoComplete","backButton","optionsWithDisabled","label","value","handleSearch","res","indexOf","map","domain","groupMenu","width","getSearchGroups","group","index","id","title","columnMenu","getSearchColumns","column","typeOfSearchMenu","console","log","length","splice","push","clickBackButton","getQuestionFromInput","runSearch","answers","findAnswers","text","newDatasource","newResultsColumns","itemIdsToFetch","Set","i","dataIndex","key","getResultItems","listen","getContext","loadModel","getBoardGroups","getAllData","createWiki","runModel","load","corpus","items","boards","setSearchColumnIds","itemIdMap","item","item_name","name","item_id","j","column_values","column_type","type","column_text","column_id","has","data","boardIds","api","then","groups","columns","selectResponseView","e","target","fontSize","email"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { useHistory, useParams } from \"react-router-dom\";\nimport { Button, PageHeader, Input, AutoComplete, Menu, Row, Col, Empty, Select, Collapse, Table, Radio } from 'antd';\nimport { PlayCircleFilled, DownOutlined, LoadingOutlined, SearchOutlined, BorderlessTableOutlined, BookOutlined } from '@ant-design/icons'\nimport '@tensorflow/tfjs-backend-webgl';\nimport mondaySdk from \"monday-sdk-js\";\n\nconst monday = mondaySdk();\nconst { Search } = Input;\nconst { Option } = Select;\nconst { Panel } = Collapse;\n// const { Option } = AutoComplete;\n\nconst qna = require(\"@tensorflow-models/qna\")\n\n\nconst SearchView = () => {\n\n    const [dataLoading, setDataLoading] = useState(false)\n    const [resultsLoading, setResultsLoading] = useState(false)\n    const [boardGroups, setBoardGroups] = useState([])\n    const [boardColumns, setBoardColumns] = useState([])\n    const [allData, setAllData] = useState({})\n    const [allResults, setAllResults] = useState({})\n    const [wiki, setWiki] = useState(\"\")\n    const [isMounted, setIsMounted] = useState(false)\n    const [boardId, setBoardId] = useState(\"\")\n    const [model, setModel] = useState()\n    const [question, setQuestion] = useState(\"\")\n    const [dataSource, setDataSource] = useState([])\n    const [resultsColumns, setResultsColumns] = useState([])\n    const [tableDataSource, setTableDataSource] = useState([])\n    const [tableDataColumns, setTableDataColumns] = useState([])\n    const [searchGroups, setSearchGroups] = useState([\"All Groups\"])\n    const [searchColumns, setSearchColumns] = useState([\"All Columns\"])\n    const [searchType, setSearchType] = useState(\"question\")\n    const [responseView, setResponseView] = useState(false)\n    const [itemIdToCorpusIdx, setItemIdToCorpusIdx] = useState({})\n    const [itemAllResults, setItemAllResults] = useState({})\n    const [getQAutoComplete, setGetQAutoComplete] = useState([]);\n\n    const backButton = useHistory()\n\n    const optionsWithDisabled = [\n        { label: <BookOutlined />, value: false },\n        { label: <BorderlessTableOutlined />, value: true },\n        // { label: 'Orange', value: 'Orange', disabled: true },\n    ];\n\n\n  const handleSearch = (value) => {\n    let res = [];\n\n    if (!value || value.indexOf('@') >= 0) {\n      res = [];\n    } else {\n      res = ['gmail.com', '163.com', 'qq.com'].map((domain) => `${value}@${domain}`);\n    }\n\n    setGetQAutoComplete(res);\n  };\n\n    const groupMenu = (\n        <Select\n            mode=\"multiple\"\n            style={{ width: '100%' }}\n            placeholder=\"select one country\"\n            defaultValue={searchGroups}\n            onChange={getSearchGroups}\n            optionLabelProp=\"label\"\n            value={searchGroups}\n        >    \n        {boardGroups.map(function (group, index){\n            return (\n                <Option value={group.id} label={group.title}>\n                    <div className=\"demo-option-label-item\">\n                        {group.title}\n                    </div>\n                </Option>\n            )\n        })}\n        </Select>\n    );\n\n    const columnMenu = (\n        <Select\n            mode=\"multiple\"\n            style={{ width: '100%' }}\n            placeholder=\"select one country\"\n            defaultValue={searchColumns}\n            onChange={getSearchColumns}\n            optionLabelProp=\"label\"\n            value={searchColumns}\n        >    \n        {boardColumns.map(function (column, index){\n            return (\n                <Option value={column.id} label={column.title}>\n                    <div className=\"demo-option-label-item\">\n                        {column.title}\n                    </div>\n                </Option>\n            )\n        })}\n        </Select>\n    );\n      \n    const typeOfSearchMenu = (\n        <Select defaultValue=\"question\" style={{ width: '100%' }} onSelect={(value) => {console.log(value)}} >\n            <Option value=\"question\">Ask Anything</Option>\n            <Option value=\"keywords\">Match Keywords</Option>\n            <Option value=\"regex\">Regex Search</Option>\n        </Select>\n    )\n\n    function getSearchColumns(value){\n        if(value.length > 1){\n            if(value[0] === \"All Columns\"){\n                value.splice(0, 1)\n            }\n        }\n        if(value.length === 0){\n            value.push(\"All Columns\")\n        }\n        setSearchColumns(value)\n        console.log(value)\n    }\n\n    function getSearchGroups(value){\n        if(value.length > 1){\n            if(value[0] === \"All Groups\"){\n                value.splice(0, 1)\n            }\n        }\n        if(value.length === 0){\n            value.push(\"All Groups\")\n        }\n        setSearchGroups(value)\n        console.log(value)\n    }\n\n    function clickBackButton(){\n        backButton.push('/')\n    }\n\n    function getQuestionFromInput(value){\n\n        setQuestion(value)\n    }\n\n    async function runSearch(){\n        // create Wiki based on groups and columns selected\n\n        if(searchType === \"question\"){\n            setResultsLoading(true)\n            if(model){\n                let answers = await model.findAnswers(question, wiki)\n                setAllResults(answers)\n            } \n        } else if(searchType === \"regex\"){\n            setAllResults({text: \"SIR PLS\"})\n        } else {\n            setAllResults({text: \"SUR PLS\"})\n        }\n    }\n\n    useEffect(() => {\n        if(isMounted){\n            // when results change, update datasource and columns\n            let newDatasource = []\n            let newResultsColumns = []\n            let itemIdsToFetch = new Set()\n            if(searchType === \"question\"){\n                for(let i = 0; i < allResults.length; i++){\n                    newDatasource.push({'Results': allResults[i].text});\n                    // newDatasource[i]['key'] = i;\n\n                }\n                if(allResults[0]){\n                    // let cols = Object.keys(allResults[0])\n                    newResultsColumns.push({\n                        title: \"Results\",\n                        dataIndex: \"Results\",\n                        key: \"Results\"\n                    })\n                    // for(let j = 0; j <= cols.length; j++){\n                    //     newResultsColumns.push({\n                    //         title: cols[j],\n                    //         dataIndex: cols[j],\n                    //         key: cols[j],\n                    //     })\n                    // }\n                }\n            } else if(searchType === \"regex\"){\n                \n            }\n            setDataSource(newDatasource)\n            setResultsColumns(newResultsColumns)\n            setResultsLoading(false)\n        }\n    }, [allResults])\n\n    async function getResultItems(){\n        \n    }\n\n    useEffect(() => {\n        if(isMounted){\n            console.log(dataSource)\n        }\n    }, [dataSource])\n\n    useEffect(() => {\n        if(isMounted){\n            console.log(resultsColumns)\n        }\n    }, [resultsColumns])\n\n    useEffect(() => {\n        // getBoardId()\n        monday.listen(\"context\", getContext);\n        setDataLoading(true)\n        loadModel()\n        setIsMounted(true)\n        setDataLoading(false)\n    }, []);\n\n    useEffect(() => {\n        if(isMounted){\n            setDataLoading(true)\n            getBoardGroups()\n            getAllData()\n            setDataLoading(false)\n            // gets triggered whenever boardId changes\n            // getBoardColumns() //\n            // get other stuff dependent on boardId too!\n        }\n\n    }, [boardId])\n\n    useEffect(() => {\n        if(isMounted){\n            setDataLoading(true)\n            createWiki()\n            setDataLoading(false)\n        }\n    }, [allData])\n\n    useEffect(() => {\n        if(isMounted){\n            // add something here?\n        }\n    }, [itemIdToCorpusIdx])\n\n    useEffect(() => {\n        if(isMounted){\n            // do something here?\n        }\n    }, [responseView])\n\n    useEffect(() => {\n        if(isMounted){\n            setDataLoading(true)\n            createWiki()\n            setDataLoading(false)\n        }\n    }, [searchColumns, searchGroups])\n\n    async function loadModel(){\n        const runModel = await qna.load(); // importing the model\n        setModel(runModel)\n    }\n\n    function createWiki(){\n        let corpus = \"\"\n        let items = allData.boards[0].items\n        // let searchColumnIds = searchColumns.map( item => { return item.id })\n        let setSearchColumnIds = new Set(searchColumns)\n        let itemIdMap = {}\n        // console.log(searchColumns)\n        // console.log(setSearchColumnIds)\n        // let column_ids = set(searchColumns)\n        for(let i = 0; i < items.length; i++){\n            let item = items[i]\n            let item_name = items[i].name\n            let item_id = items[i].id\n            itemIdMap[item_id] = corpus.length\n            // console.log(itemIdMap)\n            corpus += \"This is the entry for item \" + item_name + '.'\n            for(let j = 0; j < item.column_values.length; j++){\n                let column = item.column_values[j]\n                let column_type = column.type;\n                let column_text = column.text;\n                let column_id = column.id;\n                console.log(column_id)\n                if(setSearchColumnIds.has(column_id) || searchColumns[0] === \"All Columns\"){\n                    // This is going to change in a bit\n                    if(column_type === \"text\"){\n                        corpus += column_text;\n                    }\n                }\n            }\n        }\n        setWiki(corpus)\n        setItemIdToCorpusIdx(itemIdMap)\n    }\n\n    useEffect(() => {\n        console.log(wiki)\n    }, [wiki])\n\n    async function getContext(res){\n        setBoardId(res.data.boardIds[0])\n    }\n\n    async function getAllData(){\n        monday.api(`query {boards(ids:[${boardId}]) {items(limit:10000) {id, name, column_values {id, text, type, value, title}}}}`)\n        .then((res) => {\n            setAllData(res.data)\n            console.log(res.data)\n        })\n    }\n\n    async function getBoardGroups(){\n        monday.api(`query { boards(ids: ${boardId}) { columns { id title } groups { id title }} } `)\n        .then((res) => {\n            setBoardGroups(res.data.boards[0].groups)\n            setBoardColumns(res.data.boards[0].columns)\n        })\n    }\n\n    function selectResponseView(e){\n        if(e.target.value === false){\n            setResponseView(false)\n        } else {\n            setResponseView(true)\n        }\n    }\n\n    return (\n        <div className=\"container\">\n            <PageHeader\n                className=\"site-page-header\"\n                onBack={clickBackButton}\n                title=\"Super Search\"\n                subTitle=\"Get answers from your boards!\"\n            />\n            <div className=\"site-statistic-demo-card\">\n                { dataLoading ?      \n                    <Row gutter={[16, 24]}  justify=\"center\">\n                        <LoadingOutlined style={{ fontSize: 48 }} spin />\n                    </Row> \n                    :\n                    <Row gutter={[16, 24]}>\n                        <Col flex=\"auto\">\n                        {/* <Input\n                            placeholder=\"Ask a question!\"\n                            size=\"large\"\n                            shape=\"round\"\n                            suffix={\n                                <SearchOutlined className=\"site-form-item-icon\" />\n                            }\n     \n                        /> */}\n                         <AutoComplete\n                            style={{\n                                width: \"100%\",\n                            }}\n                            onSearch={handleSearch}\n                            placeholder=\"input here\"\n                            shape=\"round\"\n                            size=\"large\"\n                            suffix={\n                                <SearchOutlined className=\"site-form-item-icon\" />\n                            }\n                            value={question}\n                            onChange={getQuestionFromInput}\n                            >\n                            {getQAutoComplete.map((email) => (\n                                <Option key={email} value={email}>\n                                {email}\n                                </Option>\n                            ))}\n                            </AutoComplete>\n                        </Col>\n                        <Col span={4}>\n                            <Button type=\"primary\" size=\"large\" shape=\"round\" block onClick={runSearch}>Search</Button>\n                        </Col>\n                    </Row>\n                }\n                    {boardId ?\n                    <div className=\"container\">\n                     <Row gutter={[16, 24]}>\n                        <Col flex=\"auto\">\n                            <Collapse defaultActiveKey={['0']} ghost>\n                                <Panel header=\"Advanced Options\" key=\"1\">\n                                    <Row gutter={16}>\n                                        <Col span={8}>\n                                            <label>Select groups</label>\n                                            {groupMenu}\n                                        </Col>\n                                        <Col span={8}>\n                                            <label>Select columns</label>\n                                            {columnMenu}\n                                        </Col>\n                                        <Col span={8}>\n                                            <label>Select type of search</label>\n                                            {typeOfSearchMenu}\n                                        </Col>\n                                    </Row>\n                                </Panel>\n                            </Collapse>\n                        </Col>\n                        </Row>\n                        <Row gutter={ [16, 24]}>\n                            <Col flex=\"auto\">\n                                <Radio.Group\n                                    options={optionsWithDisabled}\n                                    onChange={selectResponseView}\n                                    value={responseView}\n                                    optionType=\"button\"\n                                    buttonStyle=\"solid\"\n                                />\n                            </Col>\n                        </Row>\n                        <Row gutter={[16, 24]}>\n                            <Col flex=\"auto\">\n                                {\n                                    resultsLoading ?                                     \n                                        <Table loading dataSource={dataSource} columns={resultsColumns} />\n                                    : \n                                        responseView ?\n                                            <Table dataSource={dataSource} columns={resultsColumns} />\n                                        :\n                                            <Table dataSource={tableDataSource} columns={tableDataColumns} />\n                                    }\n                                \n                            </Col>\n                        </Row>\n                        </div>\n                         :  \n                         <Row gutter={[16, 24]}>\n\n                         <Col flex=\"auto\">\n                         <Empty\n                         description={\n                           <span>\n                             Please select a board to continue...\n                           </span>\n                         }\n                       >\n                       </Empty> \n                       </Col>\n                       </Row>\n\n                    }\n            </div>\n        </div>\n    )\n\n}\n\nexport default SearchView;"]},"metadata":{},"sourceType":"module"}